# Hephora Profile Specification (v1)

This document defines how **YAML profiles** are structured in Hephora. Profiles describe the **schema** for nodes: metadata, fields, and children. They are the foundation for creating datasets and traceability inside the SDK.

---

## 1. Overview
Profiles define:
- **Metadata** ‚Üí identity of the profile.  
- **Fields** ‚Üí the data carried by each node.  
- **Children** ‚Üí relationships to profiles.  
- **Meta** ‚Üí optional UI, documentation, or display information.  

Profiles are stored as `.yaml` files in the repository.

---

## 2. Metadata
Every profile YAML must contain:

- `name`: unique identifier of the profile (e.g. `requirement`).  
- `kind`: `root` or `node`.  
  - **root** = top-level entry point (e.g. `project`).  
  - **node** = child profile (e.g. `requirement`, `attachment`).  
- `description`: explains what the profile represents.  
- `meta`: optional block defining UI and documentation attributes (see section 8).  

---

## 3. Special Fields
The system automatically includes these in every node:

- `_id`: unique identifier (string, GUID, autogenerated).  
- `_label`: display name of the node (string, provided or autogenerated).  
- `_parent_id`: reference to parent node‚Äôs `_id` (string, empty for root).  

‚ö†Ô∏è Any field beginning with `_` is reserved for internal use.

---

## 4. Field Definitions
Profiles declare fields under the `fields` section.  
Each field can specify:

- `type`: the data type.  
- `required`: true/false (default: false).  
- `default`: optional default value.  
- `description`: optional documentation.  
- `meta`: optional UI-related information (e.g. display name, hints, icons).  

### Supported types
- `string`  
- `integer`  
- `boolean`  
- `enum` (requires `values`)  
- `object` (nested `fields`)  
- `array` (requires `items`)  
- `reference` (points to another profile, requires `target`)  

---

## 5. Children
A profile can declare children in a `children` block:

- Child name (pluralized collection, e.g. `requirements`).  
- `node`: profile type of the child.  

Multiplicity is **always an array** (children are always many).

---

## 6. Notes
- **Source of truth** = YAML profiles.  
- `_id`, `_label`, `_parent_id` are always added automatically.  
- `meta` blocks do not affect backend persistence (ignored by SQLite exporter).  
- No versioning, migrations, or regex constraints are included in this version.  

---

## 7. Example Profiles

### `profiles/project.yaml`
```yaml
name: project
kind: root
description: Top-level project profile containing requirements and attachments

meta:
  alias: Project
  icon: üß†

fields:
  project_name:
    type: string
    required: true
    meta:
      alias: Project Name

  version:
    type: string
    required: true
    meta:
      alias: Version

  description:
    type: string
    required: false
    meta:
      alias: Description

  owner:
    type: string
    required: false
    meta:
      alias: Owner

children:
  requirements:
    node: requirement
    description: List of requirements belonging to this project

  attachments:
    node: attachment
    description: List of attachments directly associated with this project
```

---

### `profiles/requirement.yaml`
```yaml
name: requirement
kind: node
description: Defines a requirement with links to tests and components

meta:
  alias: Requirement
  icon: üìú

fields:
  title:
    type: string
    required: true
    meta:
      alias: Title

  priority:
    type: enum
    values: [low, medium, high]
    default: medium
    description: Priority level
    meta:
      alias: Priority

  rationale:
    type: string
    required: false
    description: Reasoning behind requirement
    meta:
      alias: Rationale

  active:
    type: boolean
    meta:
      alias: Active

  specs:
    type: object
    fields:
      manufacturer:
        type: string
        default: ToorConnect
        meta:
          alias: Manufacturer
      warranty_years:
        type: integer
        default: 3
        meta:
          alias: Warranty (years)

  tags:
    type: array
    items:
      type: string
    meta:
      alias: Tags

  references:
    type: array
    items:
      type: reference
      target: attachment
    description: References from this requirement to attachments
    meta:
      alias: References
```

---

### `profiles/attachment.yaml`
```yaml
name: attachment
kind: node
description: Defines an attachment linked to a requirement or project

meta:
  alias: Attachment
  icon: üìé

fields:
  filename:
    type: string
    required: true
    meta:
      alias: File Name

  filetype:
    type: enum
    values: [pdf, docx, xlsx, png, jpg, txt]
    required: true
    meta:
      alias: File Type

  path:
    type: string
    required: true
    meta:
      alias: File Path

  description:
    type: string
    required: false
    meta:
      alias: Description

  tags:
    type: array
    items:
      type: string
    meta:
      alias: Tags
```

---

## 8. Meta Block Specification

The optional `meta` block defines properties **not used by the database** but available for **UI, documentation, or higher-level abstractions**.

### Structure
```yaml
meta:
  alias: Human-friendly label
  icon: üß©
```

### Guidelines
- All keys are optional.  
- The backend ignores them safely.  
- They can be freely extended in the future.  
- Frontends and documentation tools can use them for:
  - Display icons and colors.  
  - Choosing which Nunjucks templates to render.  
  - Grouping or sorting profiles.  
  - Generating documentation automatically.

---
