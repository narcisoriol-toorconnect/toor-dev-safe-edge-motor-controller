_profile: sw_architecture
_id: c1c9f061-bbb9-41c9-8aa1-d9187e32a699
_label: Safe Edge SW Architecture
_parent_id: 02190274-9602-4219-a4e3-859488f14fef
architectural_decisions: "# Architectural Decisions (ADRs)\n\n## ADR-001: Three-Layer Partitioning (BSP / Safety Core / Application)\nDecision: Separate hardware access (BSP), safety-critical control (Safety Core), and non-safety application (WASM host+app).\nRationale: Predictability, auditability, and clear responsibility boundaries.\nImplications: Application cannot access hardware directly; all motion is gated by Safety Core.\n\n## ADR-002: Feature-Level BSP Abstraction\nDecision: BSP exposes feature APIs (power stage, sensors, feedback, actuators, FS, display, USB, time), hiding I2C/SPI/ADC/timers.\nRationale: Portability across STM32/ESP32/Host; stable contracts.\nImplications: Variant-specific drivers live under BSP; Safety Core stays portable.\n\n## ADR-003: WASM Application Runtime for HMI and Non-Safety Logic\nDecision: Run application code as WASM under a host runtime on device.\nRationale: Fast iteration, simulation parity, isolation from Safety Core.\nImplications: Application calls host imports (safe.* / ui.* / log.*); no direct hardware access.\n\n## ADR-004: Application A/B Updates; Safety Core Frozen in M1\nDecision: Field updates only for Application (A/B, signed). Safety Core updates deferred to service mode.\nRationale: Reduce risk; keep safety behavior stable in demo scope.\nImplications: Bootloader and post-update self-tests gate enable and allow rollback.\n\n## ADR-005: Persistent ASCII Logging with Taxonomy\nDecision: Single persistent ASCII log with category+code taxonomy and export bundle.\nRationale: Human-readable, tool-friendly, supports audits and demos.\nImplications: Ring buffer (≥1000 entries), flush ≤100 ms, export via USB.\n\n## ADR-006: Host Simulation Parity\nDecision: Provide a host BSP with fault injection and WS bridge; run same application.\nRationale: Rapid testing and client demos without hardware.\nImplications: Parity matrix maintained; timing tolerance ≤ 10%.\n\n## ADR-007: No On-Device ML in M1\nDecision: Exclude ML features from M1; plan for M2 as advisory-only in Application partition.\nRationale: Focus on safety-critical scope and core demo value.\nImplications: HMI includes Maintenance panel only when ML arrives (M2)."
attachments:
  []
description: "High-level software architecture for SafeEdge Motor Controller.\n\nLayers and boundaries:\n- Board Support Package (BSP): feature-level board abstraction (power stage, sensors, feedback, actuators, storage/FS, display, USB MSC, time, watchdog). Hides buses and peripherals; provides deterministic, bounded APIs.\n- Safety Core (Firmware): self-tests, runtime monitoring, safety FSM, command interlocks, motor control, watchdog, persistent logging. Owns motion authority and safe-state actions.\n- Application Runtime (WASM host + App): HMI logic, logging/export UI, update A/B handling, simulation bridge. No direct hardware access; interacts via Safety APIs and system services. No ML in M1.\n\nCross-cutting:\n- Event taxonomy and persistent ASCII logging (≥1000 entries).\n- A/B Application updates (signed, rollback); Safety Core not updated in-field (M1).\n- Host simulation for parity (same app code on PC with simulated BSP).\n\nStatus: proposed."
status: proposed